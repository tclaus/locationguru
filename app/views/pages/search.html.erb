<div id="main">
  <div id="left">
    <!-- search Panel -->
    <div class="row">
      <div class="col-md-offset-4 col-md-6">
        <button id="filter" class="btn btn-default" data-toggle="collapse" data-target="#collapsePanel">
          <%= t('.more_filters') %>
          <i class="fa fa-chevron-down"></i>
        </button>
      </div>
    </div>
    <div class="row">
      <br/>
      <div class="collapse" id="collapsePanel">
        <%= search_form_for @search, url: search_path do |f|%>
        <div class="row">
          <div class="col-md-8">
            <label>
              <%= t('price_range') %></label>
          </div>
          <div class="col-md-2">
            <label><%= t('Min_Price') %></label>
            <%= text_field :price_qteq, class: "form-control" %>
          </div>
          <div class="col-md-2">
            <label><%= t('Location_kind') %></label>
            <%= text_field :price_qteq, class: "form-control" %>
          </div>
          <div class="col-md-2">
            Wertigkeit
            <label><%= t('Location_Class') %></label>
            <%= text_field :price_qteq, class: "form-control" %>
          </div>
        </div>
        <hr/>
        Ammenities
        <div class="row">
          <div class="col-md-4">
            <%= check_box_tag "q[location_type_eq_any[]]", "Entire" %>
            Entire Room
          </div>
          <div class="col-md-4">
            <%= check_box_tag "q[location_type_eq_any[]]", "Private" %>
            Private Room
          </div>
          <div class="col-md-4">
            <%= check_box_tag "q[location_type_eq_any[]]", "Shared" %>
            Shared Room
          </div>
        </div>
        <hr/>
        <div class="row">
          <div class="col-md-4 select">
            <div class="form-group">
              <label><%= t('.location_type') %>
              </label>
              <%= collection_select("q[location_type]", :location_type, LocationType.all, :id, :name) %>
            </div>
          </div>

          <div class="col-md-4 select">
            <div class="form-group">
              <label><%= t('.location_kind') %></label>
              <%= collection_select("q[location_kind]", :kind_type, KindType.all, :id,:name) %>
            </div>
          </div>
        </div>
        <hr/>
        <div class="row">
          <div class="col-md-4">
            <%= check_box_tag "q[has_heating_eq]", true %>
            <%= t('.has_heating') %>
          </div>
          <div class="col-md-4">
            <%= check_box_tag "q[has_kitchen_eq]", true %>
            <%= t('.has_kitchen') %>
          </div>
          <div class="col-md-4">
            <%= check_box_tag "q[has_music_equipment_eq]", true %>
            <%= t('.has_music_equipment') %>
          </div>
          <div class="col-md-4">
            <%= check_box_tag "q[has_outdoor_eq]", true %>
            <%= t('.has_outdoor') %>
          </div>
          <div class="col-md-4">
            <%= check_box_tag "q[has_parking_space_eq]", true %>
            <%= t('.has_parking_space') %>
          </div>
        </div>
        <hr/>
        <div class="row text-center">
          <%= f.submit t('search'), class: "btn btn-form" %>
        </div>
      <% end %>
    </div>
    <br/>
    <% if !@locations.empty? %>
      <%= render 'pages/listing' %>
    <% else %>
      <%= render 'pages/no_locations_found' %>
    <% end %>

  </div>
</div>
<div id="right">
  <!-- google map -->
  <div id="map" style="width: 100%; height: 100%">
    <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['maps_key'] %>"></script>
    <script>
      console.log('enter script');
      function initialize() {
        console.log('Init Google maps');
        var location = {
          lat: 44.503,
          lng: -78.54
        };
        <% if @locations.length > 0 %>
        location = {
          lat: <%= @locations[0].latitude %>,
          lng: <%= @locations[0].longitude %>
        }
        <% end %>

        var map = new google.maps.Map(document.getElementById('map'), {
          center: location,
          zoom: 12
        });
        var marker,
          infoWindow;

        <% @locations.each do |location| %>
        <% location.price_level = 42 %>
        marker = new google.maps.Marker({
          position: {
            lat: <%= location.latitude %>,
            lng: <%= location.longitude %>
          },
          map: map
        });

        infoWindow = new google.maps.InfoWindow({
          content: "<div class='map_price'> " + <%= location.price_level %> + " </div>"
        });
        infoWindow.open(map, marker);
        <% end %>
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </div>
</div>
</div>

<script>
var open = true;
$('#filter').click(function () {
  if (open) {
    $('#filter').html("<%= t('.more_filters') %> <i class='fa fa-chevron-up'></i>");
  } else {
    $('#filter').html("<%= t('.more_filters') %> <i class='fa fa-chevron-down'></i>");
  }
  open = !open;
});
</script>
